/*!
 * bootstrap-hierarchy v1.0.0

 * Author: Pushpendra Kushwaha
 * Copyright: 2018, Pushpendra Kushwaha
 *
 */

!function(){"use strict";var e=function(e,t){var a=this;a.$element=$(e),a._init(t)},t={div:"<div>",div_close:"</div>",span:"<span>",input:"<input>",p:"<p>",select:"<select>",option:"<option>",ul:"<ul>",ul_close:"</ul>",li:"<li>",getStyle:function(e,t){return e?t+";":""},addStyle:function(e,t){e.attr("style",t)},getAttr:function(e){var t={},a={type:1,href:1,"class":1,name:1,id:1,style:1};return $.each(e.attributes,function(){a.hasOwnProperty(this.name)||(t[this.name]=this.value,console.log(this.name,this.value))}),t},getSiblings:function(e,t){var a={};return"depend"!=t&&$(e).closest("div").siblings(".ul_div").each(function(e,t){var n=$(t).children(".li_div").children("span.text").text();n.length&&(a[n]=1)}),a},checkSiblings:function(e,t){return e[t]?!0:!1},getJsonTag:function(e,t){var a=this;$.each(e,function(e,n){var s=Object.keys(n);s.length&&$.each(n,function(e,n){t.push(e),a.getJsonTag(n.data,t)})})},jsonLoop:function(e){var t=this,e=$.parseJSON(e),a=new Array;return t.getJsonTag(e,a),a},msgDiv:function(e,a){var n=$(t.div).addClass("msg-div");void 0!==a.addClass&&n.addClass(a.addClass);var s=$(t.div).addClass("h_msg-invalid").html(a.msg);return $(n).html(s),n},dependEditClick:function(e,a){var n=$(t.input,{type:"text",h_type:a.type,style:"display:none","class":"text-box"});void 0!=a.input_text&&""!=a.input_text&&n.attr({value:a.input_text,style:'display:""'});var s=$(t.select,{"class":"depends-select depends-tag"});$.each(self._options.dependDropDown,function(e,a){"object"==typeof a?$.each(a,function(e,a){s.append($(t.option).attr({value:a}).text(e))}):s.append($(t.option).attr({value:a}).text(a))});var i=$(t.select,{"class":"depends-select value-tag",disabled:!0,style:"background-color: #ccc"});void 0!=a.value_tag&&""!=a.value_tag&&i.removeAttr("disabled").removeAttr("style"),$.each(t.jsonLoop(a.h_value),function(e,n){var s=$(t.option).attr({value:n}).text(n);void 0!=a.value_tag&&a.value_tag==n&&s.attr({selected:!0}),i.append(s)});var l=$(t.p);l.append(n).append(s).append(i),e.append(l.html())},json2html:function(e,a,n){if(e.length){var s="";for(var i in e)s+='<div class="ul_div h_ml20">',"object"==typeof e[i]&&a&&$.each(e[i],function(e,i){var l=$("<span>").addClass("caret-span-down caret-down"),d=$("<span>").addClass("text").html(e),p=$("<div>").addClass("li_div"),c=$("<p>"),o="";if(i.depend){var r=$(t.p),v=$(t.span).attr({"class":"depend_txt",style:void 0===n?"display:none;":""}).html(i.depend);o=void 0===n?r.append($(t.div).addClass("m_depend h_ml20").append(v)).html():r.append(v).html()}var h=t.json2html(i.data,a,n);c.append(l).append(p.append(d)).append(o),s+=c.html(),void 0!==h&&(s+=h)}),s+=t.div_close;return s}},html2json:function(e,a){e.children(".ul_div").children(".li_div").each(function(){a.push({});var e=$(this).siblings(".m_depend").children(".depend_txt").text(),n=$(this).children("span.text").text();if(a[a.length-1][n]={},e&&(a[a.length-1][n].depend=e),a[a.length-1][n].data=[],$(this).siblings("div.ul_div").length>0){var s=$(t.p).append($(this).siblings("div.ul_div"));t.html2json(s,a[a.length-1][n].data)}})},handler:function(e,t,a){e.off(t).on(t,a)}};e.prototype={constructor:e,_init:function(e){var a=this;a._options=e,a._initEvents();var n=a.$element.attr("id");a.$element.addClass("hierarchy_"+n),t.addStyle(a.$element,a._getContainerStyle()),a._options.hierarchy="hierarchy_"+n;var s=!0;if(e.targetTo){var i=a.template(e,{});$("#"+e.targetTo).append(i)}else if("add"==e.h_type)a._generateAdd(e);else if("edit"==e.h_type)a._generateEdit(e);else if("depend"==e.h_type)a._generateDepend(e);else if("html2json"==e.h_type){a.getHtml2Json(e,{html:e.html,targetData:e.targetData});s=!1}else if("json2html"==e.h_type){var l=e.json?e.json:e.h_value;a.getJson2Html(e,{json:l,targetData:e.targetData});s=!1}s?a._listen():0},_initEvents:function(){var e=this;e.events={_selectDepend:function(t){e._commonMethod(t);var a=($(this).parent(),$(this).siblings(".value-tag")),n=$(this).siblings("input");"Fixed"==$(this).val()?(a.attr("disabled",!0),a.css("background-color","#ccc"),n.attr("style","display:none")):(a.removeAttr("disabled"),a.removeAttr("style"),n.attr("style","display:''").focus())},_clickAdd:function(a){e._commonMethod(a,e);var n=e._options,s=$(this).parent(),i=(n.h_type,e._options.hierarchy);if($("."+i+" input").length)$("."+i+" input").focus();else{var l=$(t.input,{type:"text","class":"text_add"}),d=s.parent(),p=e._div({"class":d.attr("id")!=e.$element.attr("id")?"add_hierarchy h_ml20":"add_hierarchy"}).append(l).append(e._save({"class":"save"})).append(e._cancel({"class":"cancel"}));s.remove(),d.append(p),l.focus(),e._listen()}},_clickAddDepend:function(a){e._commonMethod(a);var n=e._options,s=$(this).parent(),i=(n.h_type,$(this).siblings("input"),$(t.input,{type:"text",style:"display:none","class":"text-box"})),l=$(t.select,{"class":"depends-select depends-tag"});$.each(e._options.dependDropDown,function(e,a){"object"==typeof a?$.each(a,function(e,a){l.append($(t.option).attr({value:a}).text(e))}):l.append($(t.option).attr({value:a}).text(a))});var d=$(t.select,{"class":"depends-select value-tag",disabled:!0,style:"background-color: #ccc"});$.each(t.jsonLoop(e.$element.attr("h_value")),function(e,a){d.append($(t.option).attr({value:a}).text(a))});var p=$(t.p);p.append(i).append(l).append(d),s.append(p.html()).append(e._save({"class":"save"})).append(e._cancel({"class":"cancel"})),$(this).remove(),i.focus(),e._listen()},_clickSave:function(a){e._commonMethod(a);var n=$(this).parent(),s=e._options,i=$(this).siblings("input"),l=s.h_type,d=t.getSiblings(this,l),p=t.checkSiblings(d,i.val());if(p||"depend"!=l&&i.length&&0==i.val().length){var c=t.msgDiv(e,{msg:p?"Value Must be distinct in same level":"Please Fill Value"});n.append(c),c.children(".msg-invalid").css("font-size","14px"),i.focus()}else if(!p)if("depend"==l||$("input").hasClass("text_edit")){if("depend"==l){var o=i.val(),r=$(".depends-tag :selected").val(),v=$(".value-tag :selected").val(),h="";h="Fixed"==r?"Fixed":o+" "+r+" "+v,n.empty(),n.removeClass("m_div").addClass("m_depend").append(e._span({text:h,"class":"depend_txt"}))}else n.text(i.val());n.append(e._edit({"class":"edit"})).append(e._remove({"class":"remove"}))}else{var _=n.parent();n.remove();e.ul_li_template(_,i.val(),{"class":"add"})}$("#reverse_value").length&&$("#reverse_value").remove(),e._listen()},_clickEdit:function(a){e._commonMethod(a);var n=$(this).parent(),s=e._options,i=n.text(),l=s.h_type;if(n.empty(),"depend"==l){var d="",p="",c="";if("Fixed"==i)p="Fixed";else{var o=i.split(" % of ");d=o[0],p="% of",c=o[1]}t.dependEditClick(n,{h_value:e.$element.attr("h_value"),input_text:d,depends_tag:p,value_tag:c}),n.append(e._save({"class":"save"})).append(e._cancel({"class":"cancel"}))}else{var r=$(t.input,{type:"text","class":"text_edit text-box",value:i});n.append(r),r.after(e._cancel({"class":"cancel"})).after(e._save({"class":"save"}))}if($("#reverse_value").length)$("#reverse_value").val(i);else{var v=$(t.input,{type:"hidden",id:"reverse_value",name:"reverse_value",value:i});n.after(v)}$(this).remove(),e._listen()},_clickRemove:function(t){e._commonMethod(t);var a=e._options,n=$(this).parent(),s=(this.parentNode.tagName,a.h_type);if("depend"!=s){var i=n.parent(),l=i.parent(),d=l.attr("id")!=e.$element.attr("id")?"h_ml20":"";i.siblings(".m_div").length&&i.siblings(".m_div").remove(),l.append(e._div({"class":"m_div "+d}).append(e._add({"class":"depend"!=s?"add ":"add_depend "}))),i.remove()}else n.empty().append(e._add({"class":"depend"!=s?"add ":"add_depend "}));e._listen()},_clickCancel:function(a){e._commonMethod(a);var n=e._options,s=$(this).parent(),i=$(this).siblings("input"),l=n.h_type;if("add"==l){if(!$(i).hasClass("text_edit")){var d=s.parent();s.remove();var p=d.attr("id")!=e.$element.attr("id")?"h_ml20":"";d.append(e._div({"class":"m_div "+p}).append(e._add({"class":"depend"!=l?"add ":"add_depend "})))}}else if("edit"==l)if($(i).hasClass("text_add")&&0==i.val().length){var d=s.parent();s.remove();var p=d.attr("id")!=e.$element.attr("id")?"h_ml20":"";d.append(e._div({"class":"m_div "+p}).append(e._add({"class":"depend"!=l?"add ":"add_depend "})))}else i.length&&i.val().length&&(s.empty(),$(i).hasClass("text_edit")&&$("#reverse_value").length&&(console.log($("#reverse_value").val()),s.text($("#reverse_value").val()).append(e._edit({"class":"edit"})).append(e._remove({"class":"remove"}))));else if("depend"==l)$(this).siblings("span").remove(),$(this).siblings("select").remove(),$(this).siblings("input").remove(),$(this).after(e._add({"class":"add_depend"})),$(this).remove();else if($("input[h_type=edit]").length||$("input[h_type=depend]").length)s.empty(),s.text($("#reverse_value").val()).append(e._edit({"class":"edit"})).append(e._remove({"class":"remove"}));else{var c=t.msgDiv(e,{msg:"Please Change Value"});s.append(c),c.children(".msg-invalid").css("font-size","14px"),i.focus()}e._listen()},_clickCaretDown:function(t){e._commonMethod(t);e._options;$(this).removeClass("caret-span-down caret-down").addClass("caret-span-left caret-left"),$(this).siblings(".m_div").length&&$(this).siblings(".m_div").toggle(),$(this).siblings(".ul_div").length&&$(this).siblings(".ul_div").toggle(),$(this).siblings(".m_depend").length&&$(this).siblings(".m_depend").toggle(),e._listen()},_clickCaretLeft:function(t){e._commonMethod(t);e._options;$(this).removeClass("caret-span-left caret-left").addClass("caret-span-down caret-down"),$(this).siblings(".m_div").length&&$(this).siblings(".m_div").toggle(),$(this).siblings(".ul_div").length&&$(this).siblings(".ul_div").toggle(),$(this).siblings(".m_depend").length&&$(this).siblings(".m_depend").toggle(),e._listen()}}},_listen:function(){var e=this,a=e.$element,n=(e.events,e._options.hierarchy);return t.handler($("."+n+" .add"),"click",e.events._clickAdd),t.handler($("."+n+" .edit"),"click",e.events._clickEdit),t.handler($("."+n+" .remove"),"click",e.events._clickRemove),t.handler($("."+n+" .add_depend"),"click",e.events._clickAddDepend),t.handler($("."+n+" .save"),"click",e.events._clickSave),t.handler($("."+n+" .cancel"),"click",e.events._clickCancel),t.handler($("."+n+" .depends-tag"),"change",e.events._selectDepend),t.handler($("."+n+" .caret-down"),"click",e.events._clickCaretDown),t.handler($("."+n+" .caret-left"),"click",e.events._clickCaretLeft),a},_getContainerStyle:function(){var e=this,a=e._options;return t.getStyle(a.font_size,"font-size:"+a.font_size)},_commonMethod:function(e,t){console.log(e.handleObj.selector),$(".h_msg-div").length&&$(".h_msg-div").remove()},_span:function(e){var a=this,n=a._options,s=$(t.span,{title:n.addTitle,html:e.text});return s.addClass(e["class"])},_div:function(e){var a=$(t.div,{html:e.text,"class":e["class"],style:e.style});return a},_component:function(e){var t=this;return t._div({"class":"m_div",style:e.style}).append(t._add(e))},_add:function(e){var a=this,n=a._options,s=$(t.span,{"class":n.addIconClass,title:n.addTitle});return s.addClass(e["class"])},_save:function(e){var a=this,n=a._options,s=$(t.span,{"class":n.saveIconClass,title:n.saveTitle});return s.addClass(e["class"])},_edit:function(e){var a=this,n=a._options,s=$(t.span,{"class":n.editIconClass,title:n.editTitle});return s.addClass(e["class"])},_cancel:function(e){var a=this,n=a._options,s=$(t.span,{"class":n.cancelIconClass,title:n.editTitle});return s.addClass(e["class"])},_remove:function(e){var a=this,n=a._options,s=$(t.span,{"class":n.removeIconClass,title:n.editTitle});return s.addClass(e["class"])},_generateAdd:function(e){var t=this,a=(t._options.h_type,t._component({"class":"add"}));t.$hierarchy=a,t.$element.append(a)},_generateEdit:function(e){var a=this,n=t.json2html($.parseJSON(a.$element.attr("h_value")),!0),s=$(t.p);s.append(n),s.children(".ul_div").removeClass("h_ml20"),s.find(".li_div").each(function(){$(this).append(a._edit({"class":"edit"})).append(a._remove({"class":"remove"}))}),s.find(".ul_div").each(function(){$(this).append(a._div({"class":"m_div",style:"margin-left:17px"}).append(a._add({"class":"add"})))});var i=a._div({"class":"m_div "}).append(a._add({"class":"add"}));s.append(i),e.targetTo?$("#"+e.targetTo).append(s.html()):a.$element.append(s.html()),a._listen()},_generateDepend:function(e){var a=this,n=$(t.p),s=t.json2html($.parseJSON(a.$element.attr("h_value")),!0,"depend");n.append(s),n.find(".li_div").each(function(){if($(this).siblings(".depend_txt").length){var e=$(this).siblings(".depend_txt").html();$(this).siblings(".depend_txt").remove();var t=a._div({"class":"m_depend h_ml20"});$(this).after(t),t.append(a._span({text:e,"class":"depend_txt"})).append(a._edit({"class":"edit"})).append(a._remove({"class":"remove"}))}else $(this).after(a._div({"class":"m_div h_ml20"}).append(a._add({"class":"add_depend"})))}),n.children(".ul_div").removeClass("h_ml20"),e.targetTo?$("#"+e.targetTo).append(n.html()):a.$element.append(n.html()),a._listen()},template:function(e,a){var n=$(t.div,{"class":"panel panel-info mt0"}),s=$(t.div,{"class":"panel-title",html:e.template_title?e.template_title:a.template_title}),i=$(t.div,{"class":"panel-heading",html:s});n.append(i);var l=$(t.div,{"class":"panel-body"});n.append(l);var d=$(t.div,{"class":"panel-footer"});return n.append(d),n},ul_li_template:function(e,t,a){var n=this,s=(n._options.hierarchy,e.attr("id")!=n.$element.attr("id")?" h_ml20":""),i=n._div({"class":"ul_div"+s}).append(n._span({"class":"caret-span-down caret-down"})),l=n._div({"class":"li_div"});i.append(l),e.append(i),i.append(n._component({"class":a["class"],style:"margin-left:17px"})),l.append(n._span({"class":"text",text:t})).append(n._edit({"class":"edit"})).append(n._remove({"class":"remove"})),e.append(n._div({"class":"m_div "+s}).append(n._add({"class":"add"}))),n._listen()},getHtml2Json:function(e,a){var n=this;t.html2json(a.html,a.targetData),n.$element.attr(e.targetID,JSON.stringify(a.targetData))},getJson2Html:function(e,a){var n=this,s="string"==typeof a.json?$.parseJSON(a.json):a.json,i=t.json2html(s,!0);e.targetID?$("#"+e.targetID).html(i):(n.$element.html(i),n.$element.children(".ul_div").removeClass("h_ml20"))}},$.fn.hierarchy=function(a){this.each(function(){var n,s=$(this),i=s.data("hierarchy"),l="object"==typeof a&&a,d=t.getAttr(this);n=$.extend(!0,{},$.fn.hierarchy.defaults,d,l,s.data()),i=new e(this,n),i||(s.data("hierarchy",i),console.log(i))})},$.fn.hierarchy.defaults={font_size:"18px",addText:"Add",editText:"Edit",removeText:"Remove",cancelText:"Cancel",addTitle:"Add",removeTitle:"Remove",cancelTitle:"Cancel",addClass:"add",addDependClass:"add_depend",removeClass:"remove",cancelClass:"cancel",msgErrorClass:"msg-invalid",addIconClass:"glyphicon glyphicon-plus-sign",editIconClass:"glyphicon glyphicon-edit",saveIconClass:"glyphicon glyphicon-ok-sign",cancelIconClass:"glyphicon glyphicon-remove-sign",removeIconClass:"glyphicon glyphicon-remove-sign",dependDropDown:["Fixed","% of"]},$.fn.hierarchy.Constructor=e}();
